<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ–°å¹´è´ºå¡ - éœ“è™¹ç¯ç¬¼ä¸å¸¦ç¦å­—ç‰ˆ</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            overflow: hidden; 
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }
        #scene { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 1;
        }
        
        /* ä¸»æ ‡é¢˜ */
        .main-title {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4.5rem;
            color: transparent;
            background: linear-gradient(45deg, #FF00FF, #00FFFF, #FFFF00, #FF00FF);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 50px rgba(255, 0, 255, 0.8);
            z-index: 50;
            letter-spacing: 3px;
            text-align: center;
            animation: neonGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes neonGlow {
            0% {
                text-shadow: 0 0 10px rgba(255, 0, 255, 0.5),
                             0 0 20px rgba(255, 0, 255, 0.3),
                             0 0 30px rgba(255, 0, 255, 0.2);
            }
            100% {
                text-shadow: 0 0 20px rgba(255, 0, 255, 0.8),
                             0 0 40px rgba(255, 0, 255, 0.6),
                             0 0 60px rgba(255, 0, 255, 0.4),
                             0 0 80px rgba(255, 0, 255, 0.2);
            }
        }
        
        .sub-title {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            color: #00FFFF;
            font-size: 1.5rem;
            z-index: 50;
            text-align: center;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
        }
        
        /* éœ“è™¹å…‰æ™•æ•ˆæœ */
        .neon-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(255,0,255,0.2) 0%, rgba(0,255,255,0.1) 40%, transparent 70%);
            border-radius: 50%;
            filter: blur(60px);
            z-index: 0;
            animation: pulseGlow 4s ease-in-out infinite;
            opacity: 0.7;
        }
        
        @keyframes pulseGlow {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.9; }
        }
        
        /* è®¾ç½®é¢æ¿ */
        .settings-panel {
            position: absolute;
            top: 40px;
            left: 40px;
            width: 320px;
            background: rgba(10, 10, 30, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 0, 255, 0.4);
            z-index: 100;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4),
                        0 0 30px rgba(255, 0, 255, 0.3);
            color: white;
            transition: all 0.3s;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            color: #FF00FF;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }
        
        .settings-header h3 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .setting-group {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 3px solid #00FFFF;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .setting-label {
            display: block;
            margin-bottom: 10px;
            color: #00FFFF;
            font-size: 1rem;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-container input {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #FF00FF, #00FFFF);
            border-radius: 4px;
            outline: none;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
        }
        
        .slider-container input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            border: 2px solid #FF00FF;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.8);
            transition: all 0.3s;
        }
        
        .slider-container input::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 0, 255, 1);
        }
        
        .slider-value {
            color: #FF00FF;
            font-weight: bold;
            min-width: 50px;
            text-align: right;
            text-shadow: 0 0 5px rgba(255, 0, 255, 0.5);
        }
        
        /* éœ“è™¹å¼€å…³ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-left: 15px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, #333, #111);
            transition: .4s;
            border-radius: 34px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: linear-gradient(145deg, #fff, #ccc);
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        input:checked + .toggle-slider {
            background: linear-gradient(90deg, #FF00FF, #00FFFF);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        }
        
        /* éœ“è™¹æŒ‰é’® */
        .neon-btn {
            padding: 15px 30px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid transparent;
            border-image: linear-gradient(45deg, #FF00FF, #00FFFF) 1;
            border-radius: 15px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 20px;
        }
        
        .neon-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 0, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .neon-btn:hover::before {
            left: 100%;
        }
        
        .neon-btn:hover {
            background: rgba(255, 0, 255, 0.1);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5),
                        inset 0 0 20px rgba(255, 0, 255, 0.2);
        }
        
        /* ç¥ç¦è¯­å¡ç‰‡ */
        .wish-card {
            position: absolute;
            top: 180px;
            right: 40px;
            width: 280px;
            background: rgba(10, 10, 30, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(0, 255, 255, 0.4);
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3),
                        0 0 20px rgba(0, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .wish-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 255, 255, 0.8);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4),
                        0 0 30px rgba(0, 255, 255, 0.5);
        }
        
        .wish-title {
            color: #FF00FF;
            font-size: 1.4rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }
        
        .wish-content {
            color: white;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .wish-author {
            color: rgba(0, 255, 255, 0.7);
            font-size: 0.9rem;
            font-style: italic;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }
        
        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid transparent;
            border-image: linear-gradient(45deg, #FF00FF, #00FFFF) 1;
            color: white;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .control-btn:hover {
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5),
                        inset 0 0 20px rgba(255, 0, 255, 0.2);
        }
        
        .control-btn.active {
            background: rgba(255, 0, 255, 0.2);
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.6);
        }
        
        /* çƒŸèŠ±è®¡æ•°å™¨ */
        .counter {
            position: absolute;
            top: 40px;
            right: 40px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 0, 255, 0.4);
            border-radius: 20px;
            padding: 15px 25px;
            color: #FF00FF;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3),
                        0 0 15px rgba(255, 0, 255, 0.3);
        }
        
        /* éœ“è™¹åŠ è½½ç•Œé¢ */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s;
        }
        
        .loading .spinner {
            width: 100px;
            height: 100px;
            border: 4px solid transparent;
            border-top: 4px solid #FF00FF;
            border-bottom: 4px solid #00FFFF;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 30px;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }
        
        @keyframes spin {
            0% { 
                transform: rotate(0deg);
                box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(0, 255, 255, 0.8);
            }
            100% { 
                transform: rotate(360deg);
                box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
            }
        }
        
        .loading-text {
            color: #00FFFF;
            font-size: 1.5rem;
            animation: pulse 2s infinite;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
            margin-bottom: 20px;
        }
        
        .loading-progress {
            width: 300px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF00FF, #00FFFF);
            width: 0%;
            transition: width 0.3s;
            border-radius: 5px;
        }
        
        .loading-details {
            color: #00FFFF;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
            height: 20px;
        }
        
        /* é”™è¯¯æç¤º */
        .error-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: rgba(255, 68, 68, 0.9);
            color: white;
            text-align: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }
        
        /* ç§»åŠ¨ç«¯æç¤º */
        .mobile-tip {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1000;
            font-size: 14px;
            text-align: center;
            animation: fadeInOut 5s ease-in-out;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }
        
        /* éœ“è™¹æ•°å­—ç‰¹æ•ˆ */
        .neon-number {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, 
                rgba(255,0,255,0.3) 0%,
                rgba(0,255,255,0.2) 30%,
                transparent 70%);
            filter: blur(40px);
            z-index: -1;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .settings-panel {
                width: 280px;
                left: 20px;
                top: 20px;
                padding: 20px;
            }
            
            .wish-card {
                width: 250px;
                right: 20px;
                top: 150px;
            }
            
            .main-title {
                font-size: 3.5rem;
                top: 30px;
            }
            
            .sub-title {
                top: 100px;
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 768px) {
            .settings-panel {
                width: 90%;
                left: 5%;
                top: 20px;
            }
            
            .wish-card {
                width: 90%;
                right: 5%;
                top: 180px;
            }
            
            .main-title {
                font-size: 2.8rem;
                top: 20px;
            }
            
            .sub-title {
                top: 85px;
                font-size: 1rem;
            }
            
            .counter {
                top: 20px;
                right: 5%;
                padding: 10px 20px;
            }
            
            .controls {
                bottom: 20px;
                gap: 10px;
            }
            
            .control-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            .neon-glow {
                width: 200px;
                height: 200px;
                filter: blur(40px);
            }
            
            .loading-text {
                font-size: 1.2rem;
            }
            
            .loading-progress {
                width: 250px;
            }
        }
        
        /* å¼ºåˆ¶æ¨ªå±æç¤º */
        .landscape-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            color: white;
            text-align: center;
            padding: 50px;
        }
        
        .landscape-warning i {
            font-size: 4rem;
            color: #FF00FF;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
        }
        
        @media (max-height: 500px) and (orientation: portrait) {
            .landscape-warning {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- å¼ºåˆ¶æ¨ªå±æç¤º -->
    <div class="landscape-warning" id="landscapeWarning">
        <i class="fas fa-sync-alt fa-spin"></i>
        <h2>è¯·å°†è®¾å¤‡æ¨ªå±è§‚çœ‹</h2>
        <p>ä¸ºäº†è·å¾—æœ€ä½³ä½“éªŒï¼Œè¯·å°†æ‰‹æœº/å¹³æ¿æ¨ªç½®</p>
        <p style="margin-top: 20px; color: #00FFFF;">æ—‹è½¬è®¾å¤‡åï¼Œé¡µé¢å°†è‡ªåŠ¨åˆ·æ–°</p>
    </div>
    
    <!-- é”™è¯¯æç¤º -->
    <div class="error-message" id="errorMessage">
        <p>åŠ è½½é‡åˆ°é—®é¢˜ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–ç¨åå†è¯•</p>
        <button onclick="location.reload()" style="margin: 10px; padding: 5px 15px; background: white; border: none; border-radius: 5px; cursor: pointer;">åˆ·æ–°é¡µé¢</button>
    </div>
    
    <!-- éœ“è™¹åŠ è½½ç•Œé¢ -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">æ­£åœ¨åˆå§‹åŒ–...</div>
        <div class="loading-progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="loading-details" id="loadingDetails"></div>
        <div class="neon-number"></div>
    </div>
    
    <!-- ç§»åŠ¨ç«¯æç¤º -->
    <div class="mobile-tip" id="mobileTip"></div>
    
    <!-- éœ“è™¹èƒŒæ™¯å…‰æ™• -->
    <div class="neon-glow"></div>
    
    <!-- 3Dåœºæ™¯å®¹å™¨ -->
    <div id="scene"></div>
    
    <!-- ä¸»æ ‡é¢˜ -->
    <div class="main-title">2026</div>
    <div class="sub-title">æ–°å¹´å¿«ä¹ Â· ä¸‡äº‹å¦‚æ„</div>
    
    <!-- çƒŸèŠ±è®¡æ•°å™¨ -->
    <div class="counter" id="counter">
        <i class="fas fa-fire"></i>
        <span>çƒŸèŠ±: <span id="fireworkCount">0</span></span>
    </div>
    
    <!-- è®¾ç½®é¢æ¿ -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3><i class="fas fa-cog"></i>éœ“è™¹è®¾ç½®</h3>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                éœ“è™¹å¼ºåº¦: <span class="slider-value" id="neonIntensityValue">2.0</span>
            </label>
            <div class="slider-container">
                <input type="range" min="0.5" max="5" step="0.1" value="2.0" 
                       id="neonIntensitySlider">
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                ä¸å¸¦é€Ÿåº¦: <span class="slider-value" id="ribbonSpeedValue">0.8</span>
            </label>
            <div class="slider-container">
                <input type="range" min="0" max="2" step="0.1" value="0.8" 
                       id="ribbonSpeedSlider">
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                ç¦å­—äº®åº¦: <span class="slider-value" id="fuCharacterBrightnessValue">3.0</span>
            </label>
            <div class="slider-container">
                <input type="range" min="1" max="5" step="0.1" value="3.0" 
                       id="fuCharacterBrightnessSlider">
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                è¾‰å…‰åŠå¾„: <span class="slider-value" id="glowRadiusValue">15</span>
            </label>
            <div class="slider-container">
                <input type="range" min="5" max="30" step="1" value="15" 
                       id="glowRadiusSlider">
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                é—ªçƒé€Ÿåº¦: <span class="slider-value" id="blinkSpeedValue">1.5</span>
            </label>
            <div class="slider-container">
                <input type="range" min="0.5" max="3" step="0.1" value="1.5" 
                       id="blinkSpeedSlider">
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">
                é¢œè‰²æ¨¡å¼: <span class="slider-value" id="colorModeValue">å¤šå½©</span>
            </label>
            <div class="slider-container">
                <input type="range" min="1" max="3" step="1" value="2" 
                       id="colorModeSlider">
            </div>
        </div>
        
        <div class="setting-group" style="display: flex; align-items: center; justify-content: space-between;">
            <span class="setting-label">éœ“è™¹å…‰æ™•</span>
            <label class="toggle-switch">
                <input type="checkbox" id="neonGlowToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-group" style="display: flex; align-items: center; justify-content: space-between;">
            <span class="setting-label">ä¸å¸¦åŠ¨ç”»</span>
            <label class="toggle-switch">
                <input type="checkbox" id="ribbonAnimationToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-group" style="display: flex; align-items: center; justify-content: space-between;">
            <span class="setting-label">ç¦å­—æ—‹è½¬</span>
            <label class="toggle-switch">
                <input type="checkbox" id="fuRotationToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-group" style="display: flex; align-items: center; justify-content: space-between;">
            <span class="setting-label">åŠ¨æ€é—ªçƒ</span>
            <label class="toggle-switch">
                <input type="checkbox" id="blinkToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-group" style="display: flex; align-items: center; justify-content: space-between;">
            <span class="setting-label">è‡ªåŠ¨æ—‹è½¬</span>
            <label class="toggle-switch">
                <input type="checkbox" id="autoRotateToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <button class="neon-btn" onclick="applySettings()">
            <i class="fas fa-bolt"></i>åº”ç”¨è®¾ç½®
        </button>
    </div>
    
    <!-- ç¥ç¦è¯­å¡ç‰‡ -->
    <div class="wish-card" id="wishCard" onclick="nextWish()">
        <div class="wish-title">
            <i class="fas fa-star"></i>
            <span id="wishTitle">æ–°å¹´ç¥ç¦</span>
        </div>
        <div class="wish-content" id="wishContent">
            æ„¿2026å¹´å¸¦ç»™ä½ å¥åº·ã€å¹¸ç¦å’ŒæˆåŠŸ
        </div>
        <div class="wish-author" id="wishAuthor">- ç‚¹å‡»åˆ‡æ¢ç¥ç¦ -</div>
    </div>
    
    <!-- æ§åˆ¶æŒ‰é’® -->
    <div class="controls">
        <button class="control-btn" onclick="launchNeonFireworks()" title="å‘å°„éœ“è™¹çƒŸèŠ±">
            <i class="fas fa-bolt"></i>
        </button>
        <button class="control-btn" onclick="toggleAutoRotate()" id="rotateBtn" title="æ—‹è½¬æ§åˆ¶">
            <i class="fas fa-pause"></i>
        </button>
        <button class="control-btn" onclick="resetView()" title="é‡ç½®è§†è§’">
            <i class="fas fa-redo"></i>
        </button>
        <button class="control-btn" onclick="toggleMusic()" id="musicBtn" title="éŸ³ä¹">
            <i class="fas fa-play"></i>
        </button>
        <button class="control-btn" onclick="toggleNeonMode()" id="neonBtn" title="éœ“è™¹æ¨¡å¼">
            <i class="fas fa-lightbulb"></i>
        </button>
    </div>

    <!-- Three.js å’Œ OrbitControls - ä½¿ç”¨å›½å†…CDN -->
    <script src="https://cdn.bootcdn.net/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ====== CDNåŠ è½½å¤±è´¥å›é€€æ–¹æ¡ˆ ======
        (function() {
            console.log("å¼€å§‹åŠ è½½Three.js...");
            
            // å¦‚æœThree.jsåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ
            setTimeout(function() {
                if (typeof THREE === 'undefined') {
                    console.warn("ä¸»CDNåŠ è½½Three.jså¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ...");
                    
                    // åˆ›å»ºå¤‡ç”¨è„šæœ¬
                    const fallbackScript = document.createElement('script');
                    fallbackScript.src = 'https://unpkg.com/three@0.128.0/build/three.min.js';
                    fallbackScript.onload = function() {
                        console.log("å¤‡ç”¨CDNåŠ è½½Three.jsæˆåŠŸ");
                        loadOrbitControls();
                    };
                    fallbackScript.onerror = function() {
                        console.error("æ‰€æœ‰CDNåŠ è½½Three.jséƒ½å¤±è´¥");
                        showLoadingError("æ— æ³•åŠ è½½3Då¼•æ“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥");
                    };
                    document.head.appendChild(fallbackScript);
                } else {
                    console.log("ä¸»CDNåŠ è½½Three.jsæˆåŠŸ");
                    loadOrbitControls();
                }
            }, 2000);
            
            function loadOrbitControls() {
                console.log("å¼€å§‹åŠ è½½OrbitControls...");
                
                // åŠ è½½OrbitControls
                const orbitScript = document.createElement('script');
                orbitScript.src = 'https://cdn.bootcdn.net/ajax/libs/three.js/r128/examples/js/controls/OrbitControls.min.js';
                
                // è®¾ç½®è¶…æ—¶
                const timeoutId = setTimeout(function() {
                    console.warn("OrbitControlsåŠ è½½è¶…æ—¶ï¼Œä½¿ç”¨ç®€åŒ–æ§åˆ¶");
                    if (typeof THREE !== 'undefined') {
                        initThreeJS();
                    }
                }, 5000);
                
                orbitScript.onload = function() {
                    clearTimeout(timeoutId);
                    console.log("OrbitControlsåŠ è½½æˆåŠŸ");
                    if (typeof THREE !== 'undefined') {
                        initThreeJS();
                    }
                };
                
                orbitScript.onerror = function() {
                    clearTimeout(timeoutId);
                    console.warn("ä¸»CDNåŠ è½½OrbitControlså¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ");
                    
                    const fallbackOrbit = document.createElement('script');
                    fallbackOrbit.src = 'https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.min.js';
                    fallbackOrbit.onload = function() {
                        console.log("å¤‡ç”¨CDNåŠ è½½OrbitControlsæˆåŠŸ");
                        if (typeof THREE !== 'undefined') {
                            initThreeJS();
                        }
                    };
                    fallbackOrbit.onerror = function() {
                        console.error("æ‰€æœ‰CDNåŠ è½½OrbitControlséƒ½å¤±è´¥ï¼Œä½¿ç”¨ç®€åŒ–æ§åˆ¶");
                        if (typeof THREE !== 'undefined') {
                            initThreeJS();
                        }
                    };
                    document.head.appendChild(fallbackOrbit);
                };
                
                document.head.appendChild(orbitScript);
            }
            
            function showLoadingError(message) {
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) {
                    loadingDiv.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #FF00FF;">
                            <h2>ğŸ˜• ${message}</h2>
                            <p style="margin: 20px 0; color: #00FFFF;">å»ºè®®æ‚¨ï¼š</p>
                            <ul style="text-align: left; display: inline-block; margin: 20px auto;">
                                <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                                <li>åˆ·æ–°é¡µé¢é‡è¯•</li>
                                <li>ä½¿ç”¨Chromeæˆ–Edgeæµè§ˆå™¨</li>
                            </ul>
                            <button onclick="location.reload()" style="
                                margin-top: 30px;
                                padding: 12px 30px;
                                background: linear-gradient(145deg, #FF00FF, #00FFFF);
                                border: none;
                                border-radius: 25px;
                                color: #000;
                                font-weight: bold;
                                cursor: pointer;
                            ">
                                ğŸ”„ é‡æ–°åŠ è½½
                            </button>
                        </div>
                    `;
                }
            }
            
            // æ›´æ–°åŠ è½½çŠ¶æ€
            function updateLoadingStatus(text, progress) {
                const loadingText = document.getElementById('loadingText');
                const progressBar = document.getElementById('progressBar');
                const loadingDetails = document.getElementById('loadingDetails');
                
                if (loadingText) loadingText.textContent = text;
                if (progressBar) progressBar.style.width = progress + '%';
                if (loadingDetails) loadingDetails.textContent = `è¿›åº¦: ${progress}%`;
                
                console.log(`åŠ è½½çŠ¶æ€: ${text} (${progress}%)`);
            }
            
            // åˆå§‹åŒ–Three.jsåº”ç”¨
            window.initThreeJS = function() {
                updateLoadingStatus("3Då¼•æ“åŠ è½½å®Œæˆ", 40);
                setTimeout(function() {
                    updateLoadingStatus("æ­£åœ¨åˆå§‹åŒ–åœºæ™¯...", 60);
                    
                    // å¦‚æœOrbitControlsæœªå®šä¹‰ï¼Œä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬
                    if (typeof THREE.OrbitControls === 'undefined') {
                        console.warn("OrbitControlsæœªåŠ è½½ï¼Œä½¿ç”¨ç®€åŒ–æ§åˆ¶");
                        window.useSimpleControls = true;
                    }
                    
                    // å»¶è¿Ÿåˆå§‹åŒ–ä¸»åº”ç”¨ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºå°±ç»ª
                    setTimeout(initMainApplication, 100);
                }, 500);
            };
            
        })();
    </script>
    
    <script>
        // ====== å…¨å±€å˜é‡ ======
        let scene, camera, renderer, controls;
        let lanterns = [];
        let neonParticles = [];
        let neonLights = [];
        let neonRibbons = [];
        let fuCharacterGroup = null;
        let isAutoRotating = true;
        let fireworkCount = 0;
        let audio = null;
        let isMusicPlaying = false;
        let isNeonMode = true;
        
        // éœ“è™¹è®¾ç½®
        let neonIntensity = 2.0;
        let glowRadius = 15;
        let blinkSpeed = 1.5;
        let colorMode = 2; // 1:å•è‰², 2:å¤šå½©, 3:å½©è™¹
        let isNeonGlow = true;
        let isBlinking = true;
        
        // ä¸å¸¦è®¾ç½®
        let ribbonSpeed = 0.8;
        let isRibbonAnimating = true;
        
        // ç¦å­—è®¾ç½®
        let fuCharacterBrightness = 3.0;
        let isFuRotating = true;
        
        // éœ“è™¹é¢œè‰²æ–¹æ¡ˆ
        const neonColors = [
            [0xFF00FF, 0x00FFFF], // æ´‹çº¢-é’è‰²
            [0x00FF00, 0xFF0000], // ç»¿-çº¢
            [0xFFFF00, 0xFF00FF], // é»„-æ´‹çº¢
            [0x00FFFF, 0x00FF00], // é’-ç»¿
            [0xFF0000, 0xFFFF00], // çº¢-é»„
        ];
        
        // å½©è™¹é¢œè‰²
        const rainbowColors = [
            0xFF0000, 0xFF7F00, 0xFFFF00, 0x00FF00, 
            0x0000FF, 0x4B0082, 0x8F00FF
        ];
        
        // ç¥ç¦è¯­
        const wishes = [
            {
                title: "æ–°å¹´å¿«ä¹",
                content: "2026å¹´ï¼Œæ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰ï¼Œæ¯ä¸€æ­¥éƒ½èµ°å‘è¾‰ç…Œï¼æ–°çš„ä¸€å¹´ï¼Œæ–°çš„èµ·ç‚¹ï¼Œæ„¿ä½ å¿ƒæƒ³äº‹æˆï¼Œä¸‡äº‹å¦‚æ„ï¼",
                author: "æ–°å¹´ç¥ç¦"
            },
            {
                title: "ä¸‡äº‹å¦‚æ„",
                content: "æ„¿æ–°çš„ä¸€å¹´é‡Œï¼Œä½ æ‰€æœ‰çš„å¸Œæœ›éƒ½èƒ½å¦‚æ„¿ï¼Œæ‰€æœ‰çš„æ¢¦æƒ³éƒ½èƒ½å®ç°ï¼äº‹ä¸šé¡ºåˆ©ï¼Œå®¶åº­ç¾æ»¡ï¼Œèº«ä½“å¥åº·ï¼",
                author: "ç¾å¥½ç¥æ„¿"
            },
            {
                title: "é˜–å®¶å¹¸ç¦",
                content: "ç¥ç¦æ‚¨å’Œå®¶äººåœ¨2026å¹´ï¼šèº«ä½“å¥åº·ï¼Œå·¥ä½œé¡ºåˆ©ï¼Œç”Ÿæ´»ç¾æ»¡ï¼å›¢å›¢åœ†åœ†ï¼Œå¹¸ç¦å®‰åº·ï¼",
                author: "æ¸©é¦¨ç¥ç¦"
            },
            {
                title: "å‰ç¨‹ä¼¼é”¦",
                content: "æ„¿2026å¹´çš„ä½ ï¼Œäº‹ä¸šå¦‚æ—¥ä¸­å¤©ï¼Œå‰ç¨‹ä¼¼é”¦ï¼Œæ­¥æ­¥é«˜å‡ï¼å®ç°æ‰€æœ‰ç›®æ ‡ï¼Œæ”¶è·æ›´å¤šæˆåŠŸï¼",
                author: "äº‹ä¸šç¥ç¦"
            },
            {
                title: "å¿ƒæƒ³äº‹æˆ",
                content: "æ–°çš„ä¸€å¹´ï¼Œæ„¿ä½ æ‰€æƒ³çš†æ‰€å¾—ï¼Œæ‰€æ„¿çš†å®ç°ï¼Œæ¯ä¸€å¤©éƒ½å……æ»¡æƒŠå–œï¼å¿«ä¹æ°¸é©»ï¼Œå¹¸ç¦å¸¸ä¼´ï¼",
                author: "å¿ƒæ„¿ç¥ç¦"
            }
        ];
        let wishIndex = 0;
        
        // ====== ä¸»åº”ç”¨åˆå§‹åŒ– ======
        function initMainApplication() {
            console.log("æ­£åœ¨åˆå§‹åŒ–ä¸»åº”ç”¨...");
            
            try {
                // æ£€æµ‹WebGLæ”¯æŒ
                if (!isWebGLAvailable()) {
                    throw new Error("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebGLï¼Œè¯·ä½¿ç”¨Chromeã€Edgeç­‰ç°ä»£æµè§ˆå™¨");
                }
                
                // åˆ›å»ºåœºæ™¯
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000000);
                
                // åˆ›å»ºç›¸æœº
                camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 20, 45);
                
                // åˆ›å»ºæ¸²æŸ“å™¨
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: false,
                    powerPreference: "high-performance"
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                renderer.outputEncoding = THREE.sRGBEncoding;
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1.2;
                
                document.getElementById('scene').appendChild(renderer.domElement);
                
                // åˆ›å»ºè½¨é“æ§åˆ¶æˆ–ç®€åŒ–æ§åˆ¶
                if (typeof THREE.OrbitControls !== 'undefined' && !window.useSimpleControls) {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    controls.maxDistance = 100;
                    controls.minDistance = 15;
                    console.log("ä½¿ç”¨OrbitControls");
                } else {
                    // ä½¿ç”¨ç®€åŒ–æ§åˆ¶
                    createSimpleControls();
                    console.log("ä½¿ç”¨ç®€åŒ–æ§åˆ¶");
                }
                
                updateLoadingStatus("æ­£åœ¨åˆ›å»ºåœºæ™¯å…ƒç´ ...", 70);
                
                // åˆ›å»ºåœºæ™¯å…ƒç´ 
                setupNeonEnvironment();
                createNeonGround();
                createNeonYear2026();
                createNeonLanterns();
                createFixedRibbons();
                createFuCharacter();
                createNeonParticles();
                createNeonLightStreaks();
                
                // æ›´æ–°UI
                updateWish();
                updateFireworkCount();
                
                updateLoadingStatus("æ­£åœ¨è®¾ç½®äº‹ä»¶ç›‘å¬...", 80);
                
                // äº‹ä»¶ç›‘å¬
                setupEventListeners();
                
                updateLoadingStatus("æ­£åœ¨å¯åŠ¨åŠ¨ç”»å¾ªç¯...", 90);
                
                // åŠ¨ç”»å¾ªç¯
                animate();
                
                // å®ŒæˆåŠ è½½
                setTimeout(() => {
                    updateLoadingStatus("åŠ è½½å®Œæˆï¼", 100);
                    
                    setTimeout(() => {
                        const loadingDiv = document.getElementById('loading');
                        loadingDiv.style.opacity = '0';
                        
                        setTimeout(() => {
                            loadingDiv.style.display = 'none';
                            
                            // æ˜¾ç¤ºç§»åŠ¨ç«¯æç¤º
                            if (isMobileDevice()) {
                                showMobileTip("ğŸ“± ç‚¹å‡»å±å¹•å‘å°„çƒŸèŠ±ï¼ŒåŒæŒ‡ç¼©æ”¾æ—‹è½¬");
                            }
                            
                            // è‡ªåŠ¨å‘å°„éœ“è™¹çƒŸèŠ±
                            setTimeout(() => {
                                launchNeonFireworks(3);
                            }, 1000);
                            
                            console.log("éœ“è™¹åœºæ™¯åŠ è½½å®Œæˆï¼");
                            
                        }, 1000);
                    }, 1000);
                }, 1000);
                
            } catch (error) {
                console.error("åˆå§‹åŒ–å¤±è´¥:", error);
                handleInitError(error);
            }
        }
        
        // ====== è¾…åŠ©å‡½æ•° ======
        function isWebGLAvailable() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && 
                    (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
            } catch (e) {
                return false;
            }
        }
        
        function isMobileDevice() {
            return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        }
        
        function showMobileTip(text) {
            const tip = document.getElementById('mobileTip');
            if (tip) {
                tip.textContent = text;
                tip.style.display = 'block';
                setTimeout(() => {
                    tip.style.display = 'none';
                }, 5000);
            }
        }
        
        function updateLoadingStatus(text, progress) {
            const loadingText = document.getElementById('loadingText');
            const progressBar = document.getElementById('progressBar');
            const loadingDetails = document.getElementById('loadingDetails');
            
            if (loadingText) loadingText.textContent = text;
            if (progressBar) progressBar.style.width = progress + '%';
            if (loadingDetails) loadingDetails.textContent = `è¿›åº¦: ${progress}%`;
        }
        
        function handleInitError(error) {
            const loadingDiv = document.getElementById('loading');
            if (!loadingDiv) return;
            
            loadingDiv.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #FF00FF;">
                    <h2>ğŸ˜• åŠ è½½é‡åˆ°é—®é¢˜</h2>
                    <p style="margin: 20px 0; color: #00FFFF;">${error.message || 'æœªçŸ¥é”™è¯¯'}</p>
                    
                    <div style="margin: 30px 0;">
                        <h3>ğŸ’¡ å»ºè®®ï¼š</h3>
                        <ul style="text-align: left; display: inline-block; margin: 20px auto;">
                            <li>ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨</li>
                            <li>ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸</li>
                            <li>æŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°</li>
                            <li>ç¦ç”¨å¹¿å‘Šæ‹¦æˆªå™¨</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <button onclick="location.reload()" style="
                            padding: 15px 30px;
                            margin: 10px;
                            background: linear-gradient(145deg, #FF00FF, #00FFFF);
                            border: none;
                            border-radius: 25px;
                            color: #000;
                            font-weight: bold;
                            font-size: 16px;
                            cursor: pointer;
                            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
                        ">
                            ğŸ”„ é‡æ–°åŠ è½½
                        </button>
                        
                        <button onclick="showSimpleVersion()" style="
                            padding: 15px 30px;
                            margin: 10px;
                            background: linear-gradient(145deg, #00FFFF, #FF00FF);
                            border: none;
                            border-radius: 25px;
                            color: #000;
                            font-weight: bold;
                            font-size: 16px;
                            cursor: pointer;
                            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
                        ">
                            ğŸ’¡ ç®€åŒ–ç‰ˆæœ¬
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ç®€åŒ–ç‰ˆæœ¬
        function showSimpleVersion() {
            document.body.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0; left: 0;
                    width: 100%; height: 100%;
                    background: linear-gradient(45deg, #000022, #220033);
                    color: white;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    text-align: center;
                    padding: 20px;
                ">
                    <div style="
                        background: rgba(0, 0, 0, 0.7);
                        padding: 40px;
                        border-radius: 20px;
                        border: 2px solid rgba(255, 0, 255, 0.5);
                        max-width: 600px;
                        backdrop-filter: blur(10px);
                    ">
                        <h1 style="
                            font-size: 4rem;
                            background: linear-gradient(45deg, #FF00FF, #00FFFF);
                            -webkit-background-clip: text;
                            background-clip: text;
                            color: transparent;
                            margin-bottom: 10px;
                        ">2026</h1>
                        
                        <h2 style="color: #00FFFF; margin-bottom: 30px;">æ–°å¹´å¿«ä¹ Â· ä¸‡äº‹å¦‚æ„</h2>
                        
                        <div style="margin: 30px 0;">
                            <div style="
                                width: 200px; height: 200px;
                                margin: 0 auto;
                                background: radial-gradient(circle, rgba(255,0,255,0.3) 0%, rgba(0,255,255,0.2) 50%, transparent 70%);
                                border-radius: 50%;
                                position: relative;
                            ">
                                <div style="
                                    position: absolute;
                                    top: 50%; left: 50%;
                                    transform: translate(-50%, -50%);
                                    font-size: 5rem;
                                    color: #FF0000;
                                    text-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
                                ">ç¦</div>
                            </div>
                        </div>
                        
                        <div style="margin: 30px 0; color: #FFFFFF;">
                            <p style="font-size: 1.2rem; line-height: 1.6;">
                                æ„¿2026å¹´å¸¦ç»™ä½ å¥åº·ã€å¹¸ç¦å’ŒæˆåŠŸï¼<br>
                                è™½ç„¶3Dæ•ˆæœåŠ è½½å¤±è´¥ï¼Œä½†ç¥ç¦ä¾æ—§é€è¾¾ï¼ğŸ‰
                            </p>
                        </div>
                        
                        <button onclick="launchVirtualFireworks()" style="
                            padding: 15px 40px;
                            margin: 20px;
                            background: linear-gradient(145deg, #FF00FF, #00FFFF);
                            border: none;
                            border-radius: 25px;
                            color: #000;
                            font-weight: bold;
                            font-size: 18px;
                            cursor: pointer;
                            box-shadow: 0 0 40px rgba(255, 0, 255, 0.7);
                            transition: all 0.3s;
                        " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                            ğŸŠ å‘å°„è™šæ‹ŸçƒŸèŠ±
                        </button>
                        
                        <div style="margin-top: 30px; color: #888;">
                            <p>åŸç‰ˆ3Dè´ºå¡å¯èƒ½å› ç½‘ç»œé—®é¢˜æš‚æ—¶æ— æ³•åŠ è½½</p>
                            <p>å»ºè®®ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ</p>
                        </div>
                    </div>
                </div>
                <script>
                    function launchVirtualFireworks() {
                        const colors = ['#FF00FF', '#00FFFF', '#FFFF00', '#FF0000', '#00FF00'];
                        for (let i = 0; i < 20; i++) {
                            setTimeout(() => {
                                const firework = document.createElement('div');
                                firework.style.cssText = \`
                                    position: fixed;
                                    top: \${Math.random() * 80 + 10}%;
                                    left: \${Math.random() * 80 + 10}%;
                                    width: 10px;
                                    height: 10px;
                                    background: \${colors[Math.floor(Math.random() * colors.length)]};
                                    border-radius: 50%;
                                    box-shadow: 0 0 20px currentColor;
                                    z-index: 1000;
                                    animation: virtualFirework 1s ease-out forwards;
                                \`;
                                document.body.appendChild(firework);
                                setTimeout(() => firework.remove(), 1000);
                            }, i * 100);
                        }
                    }
                    
                    // æ·»åŠ è™šæ‹ŸçƒŸèŠ±åŠ¨ç”»
                    const style = document.createElement('style');
                    style.textContent = \`
                        @keyframes virtualFirework {
                            0% { transform: scale(1); opacity: 1; }
                            100% { transform: scale(3); opacity: 0; }
                        }
                    \`;
                    document.head.appendChild(style);
                <\/script>
            `;
        }
        
        // ====== ç®€åŒ–æ§åˆ¶ï¼ˆå½“OrbitControlsä¸å¯ç”¨æ—¶ï¼‰ ======
        function createSimpleControls() {
            let mouseX = 0, mouseY = 0;
            let targetX = 0, targetY = 0;
            const windowHalfX = window.innerWidth / 2;
            const windowHalfY = window.innerHeight / 2;
            
            // é¼ æ ‡ç§»åŠ¨æ§åˆ¶
            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX - windowHalfX) / 100;
                mouseY = (event.clientY - windowHalfY) / 100;
            });
            
            // è§¦æ‘¸æ§åˆ¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
            document.addEventListener('touchmove', (event) => {
                if (event.touches.length === 1) {
                    const touch = event.touches[0];
                    mouseX = (touch.clientX - windowHalfX) / 50;
                    mouseY = (touch.clientY - windowHalfY) / 50;
                    event.preventDefault();
                }
            }, { passive: false });
            
            // ç¼©æ”¾æ§åˆ¶
            document.addEventListener('wheel', (event) => {
                const zoomSpeed = 0.1;
                const delta = event.deltaY > 0 ? zoomSpeed : -zoomSpeed;
                camera.position.z += delta;
                camera.position.z = Math.max(15, Math.min(100, camera.position.z));
                event.preventDefault();
            }, { passive: false });
            
            // åŒæŒ‡ç¼©æ”¾ï¼ˆç§»åŠ¨ç«¯ï¼‰
            let initialDistance = 0;
            document.addEventListener('touchstart', (event) => {
                if (event.touches.length === 2) {
                    initialDistance = Math.hypot(
                        event.touches[0].clientX - event.touches[1].clientX,
                        event.touches[0].clientY - event.touches[1].clientY
                    );
                }
            });
            
            document.addEventListener('touchmove', (event) => {
                if (event.touches.length === 2) {
                    const currentDistance = Math.hypot(
                        event.touches[0].clientX - event.touches[1].clientX,
                        event.touches[0].clientY - event.touches[1].clientY
                    );
                    
                    const delta = (initialDistance - currentDistance) * 0.01;
                    camera.position.z += delta;
                    camera.position.z = Math.max(15, Math.min(100, camera.position.z));
                    initialDistance = currentDistance;
                    event.preventDefault();
                }
            }, { passive: false });
            
            // å­˜å‚¨æ§åˆ¶æ›´æ–°å‡½æ•°
            window.simpleControlsUpdate = function() {
                targetX += (mouseX - targetX) * 0.05;
                targetY += (mouseY - targetY) * 0.05;
                
                camera.position.x += (targetX - camera.position.x) * 0.05;
                camera.position.y += (-targetY - camera.position.y) * 0.05;
                camera.lookAt(scene.position);
                
                // é‡ç½®é¼ æ ‡ä½ç½®
                mouseX *= 0.95;
                mouseY *= 0.95;
            };
        }
        
        // ====== ä»¥ä¸‹æ˜¯ä½ åŸæœ‰çš„Three.jsåœºæ™¯ä»£ç  ======
        // ç”±äºä»£ç éå¸¸é•¿ï¼Œæˆ‘ä¿ç•™äº†æ ¸å¿ƒç»“æ„ï¼Œä½†è¯·æ³¨æ„ï¼š
        // 1. æ‰€æœ‰å¯¹controlsçš„å¼•ç”¨éƒ½éœ€è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨
        // 2. ç§»åŠ¨ç«¯éœ€è¦ä¼˜åŒ–æ€§èƒ½
        
        // è®¾ç½®éœ“è™¹ç¯å¢ƒ
        function setupNeonEnvironment() {
            // æ·±è‰²èƒŒæ™¯
            scene.background = new THREE.Color(0x000011);
            
            // ç¯å¢ƒå…‰ - ä½¿ç”¨éœ“è™¹è‰²è°ƒ
            const ambientLight = new THREE.AmbientLight(0x220033, 0.6);
            scene.add(ambientLight);
            
            // ä¸»éœ“è™¹å…‰
            const neonLight = new THREE.PointLight(0xFF00FF, 2, 50);
            neonLight.position.set(0, 30, 0);
            neonLight.castShadow = true;
            scene.add(neonLight);
            
            // è¾…åŠ©éœ“è™¹å…‰
            const cyanLight = new THREE.PointLight(0x00FFFF, 1.5, 50);
            cyanLight.position.set(30, 20, 10);
            scene.add(cyanLight);
            
            const yellowLight = new THREE.PointLight(0xFFFF00, 1.5, 50);
            yellowLight.position.set(-30, 20, -10);
            scene.add(yellowLight);
            
            // æ·»åŠ å½©è™¹ç‚¹å…‰æº
            for (let i = 0; i < 8; i++) {
                const color = rainbowColors[i % rainbowColors.length];
                const pointLight = new THREE.PointLight(color, 0.8, 40);
                pointLight.position.set(
                    (Math.random() - 0.5) * 60,
                    Math.random() * 30 + 10,
                    (Math.random() - 0.5) * 60
                );
                pointLight.userData = {
                    originalY: pointLight.position.y,
                    pulseSpeed: 0.5 + Math.random() * 1.5,
                    pulseOffset: Math.random() * Math.PI * 2
                };
                scene.add(pointLight);
                neonLights.push(pointLight);
            }
        }
        
        // åˆ›å»ºéœ“è™¹åœ°é¢
        function createNeonGround() {
            // ä¸»åœ°é¢
            const groundGeometry = new THREE.CircleGeometry(100, 128);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x110022,
                roughness: 0.8,
                metalness: 0.3,
                emissive: 0x220033,
                emissiveIntensity: 0.3
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -5;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // éœ“è™¹åå°„å±‚
            const reflectionGeometry = new THREE.CircleGeometry(100, 128);
            const reflectionMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x00FFFF,
                transparent: true,
                opacity: 0.1,
                blending: THREE.AdditiveBlending
            });
            const reflection = new THREE.Mesh(reflectionGeometry, reflectionMaterial);
            reflection.rotation.x = -Math.PI / 2;
            reflection.position.y = -4.9;
            scene.add(reflection);
        }
        
        // åˆ›å»ºéœ“è™¹2026æ•°å­—
        function createNeonYear2026() {
            const numbers = [
                { value: '2', color: 0xFF00FF, position: [-9, 8, 0] },
                { value: '0', color: 0x00FFFF, position: [-3, 8, 0] },
                { value: '2', color: 0xFFFF00, position: [3, 8, 0] },
                { value: '6', color: 0xFF4500, position: [9, 8, 0] }
            ];
            
            numbers.forEach((num, index) => {
                // æ•°å­—ä¸»ä½“
                const geometry = new THREE.BoxGeometry(3.5, 5, 0.8);
                const material = new THREE.MeshPhongMaterial({ 
                    color: num.color,
                    emissive: num.color,
                    emissiveIntensity: neonIntensity,
                    shininess: 30,
                    transparent: true,
                    opacity: 0.9
                });
                const number = new THREE.Mesh(geometry, material);
                number.position.set(num.position[0], num.position[1], num.position[2]);
                number.castShadow = true;
                
                // æ•°å­—å…‰æ™•
                const glowGeometry = new THREE.SphereGeometry(2, 32, 32);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: num.color,
                    transparent: true,
                    opacity: 0.3,
                    blending: THREE.AdditiveBlending,
                    side: THREE.BackSide
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                glow.position.set(num.position[0], num.position[1], num.position[2]);
                scene.add(glow);
                
                // æ·»åŠ éœ“è™¹ç¯å…‰
                const light = new THREE.PointLight(num.color, neonIntensity * 2, glowRadius);
                light.position.set(num.position[0], num.position[1], num.position[2]);
                scene.add(light);
                
                // æ·»åŠ åŠ¨ç”»æ•°æ®
                number.userData = {
                    originalY: num.position[1],
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed,
                    glow: glow,
                    light: light
                };
                
                glow.userData = {
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed * 0.7
                };
                
                scene.add(number);
            });
        }
        
        // åˆ›å»ºéœ“è™¹ç¯ç¬¼
        function createNeonLanterns() {
            const lanternCount = isMobileDevice() ? 6 : 12;
            
            for (let i = 0; i < lanternCount; i++) {
                const angle = (i / lanternCount) * Math.PI * 2;
                const radius = isMobileDevice() ? 20 : 25;
                
                // ç¯ç¬¼ç»„
                const lantern = new THREE.Group();
                
                // é€‰æ‹©éœ“è™¹é¢œè‰²
                const colors = neonColors[i % neonColors.length];
                const mainColor = colors[0];
                const accentColor = colors[1];
                
                // ç¯ç¬¼éª¨æ¶ - éœ“è™¹ç®¡æ•ˆæœ
                const frameGeometry = new THREE.TorusGeometry(1.2, 0.15, 16, 32);
                const frameMaterial = new THREE.MeshPhongMaterial({ 
                    color: mainColor,
                    emissive: mainColor,
                    emissiveIntensity: neonIntensity,
                    shininess: 100,
                    transparent: true,
                    opacity: 0.9
                });
                
                // é¡¶éƒ¨éª¨æ¶
                const topFrame = new THREE.Mesh(frameGeometry, frameMaterial);
                topFrame.position.y = 2.8;
                lantern.add(topFrame);
                
                // ä¸­éƒ¨éª¨æ¶
                const middleFrame = new THREE.Mesh(frameGeometry, frameMaterial);
                middleFrame.position.y = 1.4;
                middleFrame.scale.set(0.9, 0.9, 0.9);
                lantern.add(middleFrame);
                
                // åº•éƒ¨éª¨æ¶
                const bottomFrame = new THREE.Mesh(frameGeometry, frameMaterial);
                bottomFrame.position.y = 0;
                bottomFrame.scale.set(0.8, 0.8, 0.8);
                lantern.add(bottomFrame);
                
                // ç¯ç¬¼çº¸ - éœ“è™¹å‘å…‰æ•ˆæœ
                const lanternPaperGeometry = new THREE.SphereGeometry(1.1, 32, 32, 0, Math.PI * 2, 0, Math.PI);
                const lanternPaperMaterial = new THREE.MeshPhongMaterial({
                    color: accentColor,
                    emissive: accentColor,
                    emissiveIntensity: neonIntensity * 0.8,
                    transparent: true,
                    opacity: 0.7,
                    side: THREE.DoubleSide
                });
                const lanternPaper = new THREE.Mesh(lanternPaperGeometry, lanternPaperMaterial);
                lanternPaper.position.y = 1.4;
                lanternPaper.scale.set(1, 1.8, 1);
                lanternPaper.castShadow = true;
                lantern.add(lanternPaper);
                
                // ç¯ç¬¼å…‰æ™•
                const glowGeometry = new THREE.SphereGeometry(1.8, 32, 32);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: mainColor,
                    transparent: true,
                    opacity: 0.2,
                    blending: THREE.AdditiveBlending,
                    side: THREE.BackSide
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                glow.position.y = 1.4;
                glow.scale.set(1, 1.8, 1);
                lantern.add(glow);
                
                // éœ“è™¹ç¯å…‰
                const lanternLight = new THREE.PointLight(mainColor, neonIntensity * 1.5, glowRadius);
                lanternLight.position.set(0, 1.4, 0);
                lanternLight.castShadow = true;
                lantern.add(lanternLight);
                
                // ç¯ç¬¼ç©—å­
                const tasselGroup = new THREE.Group();
                const tasselGeometry = new THREE.ConeGeometry(0.08, 1.8, 8);
                const tasselMaterial = new THREE.MeshPhongMaterial({ 
                    color: accentColor,
                    emissive: accentColor,
                    emissiveIntensity: neonIntensity * 0.6
                });
                const mainTassel = new THREE.Mesh(tasselGeometry, tasselMaterial);
                mainTassel.position.y = -1.2;
                mainTassel.rotation.x = Math.PI;
                tasselGroup.add(mainTassel);
                
                lantern.add(tasselGroup);
                
                // è®¾ç½®ç¯ç¬¼ä½ç½®
                lantern.position.set(
                    Math.cos(angle) * radius,
                    12 + Math.sin(angle * 2) * 2,
                    Math.sin(angle) * radius
                );
                
                // æ·»åŠ åŠ¨ç”»æ•°æ®
                lantern.userData = {
                    originalY: lantern.position.y,
                    swingSpeed: 0.3 + Math.random() * 0.4,
                    rotateSpeed: 0.02 + Math.random() * 0.03,
                    swingOffset: Math.random() * Math.PI * 2,
                    floatOffset: Math.random() * Math.PI * 2,
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed,
                    glow: glow,
                    light: lanternLight,
                    mainColor: mainColor,
                    accentColor: accentColor
                };
                
                scene.add(lantern);
                lanterns.push(lantern);
            }
        }
        
        // åˆ›å»ºç¦å­—
        function createFuCharacter() {
            fuCharacterGroup = new THREE.Group();
            
            // ç¦å­—åŸºåº§
            const baseGeometry = new THREE.BoxGeometry(8, 0.5, 8);
            const baseMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xFF0000,
                emissive: 0xFF0000,
                emissiveIntensity: fuCharacterBrightness * 0.5,
                shininess: 30,
                transparent: true,
                opacity: 0.9
            });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.set(0, 0, 0);
            fuCharacterGroup.add(base);
            
            // ç¦å­—åŸºåº§å…‰æ™•
            const baseGlowGeometry = new THREE.BoxGeometry(9, 1, 9);
            const baseGlowMaterial = new THREE.MeshBasicMaterial({
                color: 0xFF0000,
                transparent: true,
                opacity: 0.2,
                blending: THREE.AdditiveBlending,
                side: THREE.BackSide
            });
            const baseGlow = new THREE.Mesh(baseGlowGeometry, baseGlowMaterial);
            baseGlow.position.set(0, 0, 0);
            fuCharacterGroup.add(baseGlow);
            
            // åˆ›å»ºç¦å­—çš„ç¬”ç”»
            createFuCharacterStrokes();
            
            // ç¦å­—ä¸­å¿ƒè£…é¥°
            const centerOrbGeometry = new THREE.SphereGeometry(0.8, 32, 32);
            const centerOrbMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xFFFF00,
                emissive: 0xFFFF00,
                emissiveIntensity: fuCharacterBrightness * 1.5,
                shininess: 50,
                transparent: true,
                opacity: 0.9
            });
            const centerOrb = new THREE.Mesh(centerOrbGeometry, centerOrbMaterial);
            centerOrb.position.set(0, 2, 0);
            fuCharacterGroup.add(centerOrb);
            
            // ä¸­å¿ƒè£…é¥°å…‰æ™•
            const centerGlowGeometry = new THREE.SphereGeometry(1.2, 32, 32);
            const centerGlowMaterial = new THREE.MeshBasicMaterial({
                color: 0xFFFF00,
                transparent: true,
                opacity: 0.3,
                blending: THREE.AdditiveBlending,
                side: THREE.BackSide
            });
            const centerGlow = new THREE.Mesh(centerGlowGeometry, centerGlowMaterial);
            centerGlow.position.set(0, 2, 0);
            fuCharacterGroup.add(centerGlow);
            
            // ç¦å­—é¡¶éƒ¨è£…é¥°
            const topOrnamentGeometry = new THREE.TorusGeometry(2, 0.2, 16, 32);
            const topOrnamentMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xFF00FF,
                emissive: 0xFF00FF,
                emissiveIntensity: fuCharacterBrightness,
                shininess: 40,
                transparent: true,
                opacity: 0.9
            });
            const topOrnament = new THREE.Mesh(topOrnamentGeometry, topOrnamentMaterial);
            topOrnament.position.set(0, 4.5, 0);
            topOrnament.rotation.x = Math.PI / 2;
            fuCharacterGroup.add(topOrnament);
            
            // ç¦å­—ç¯å…‰
            const fuLight = new THREE.PointLight(0xFF0000, fuCharacterBrightness * 2, 20);
            fuLight.position.set(0, 2, 0);
            fuCharacterGroup.add(fuLight);
            
            // ç¦å­—ä½ç½®
            fuCharacterGroup.position.set(0, 10, 0);
            
            // æ·»åŠ åŠ¨ç”»æ•°æ®
            fuCharacterGroup.userData = {
                rotateSpeed: 0.02,
                pulseOffset: Math.random() * Math.PI * 2,
                pulseSpeed: blinkSpeed * 0.5,
                floatOffset: Math.random() * Math.PI * 2,
                floatSpeed: 0.3
            };
            
            scene.add(fuCharacterGroup);
        }
        
        // åˆ›å»ºç¦å­—ç¬”ç”»
        function createFuCharacterStrokes() {
            const strokes = [
                { position: [0, 4, 0], size: [3, 0.3, 0.2], color: 0xFF0000 },
                { position: [-1.3, 3, 0], size: [0.2, 2, 0.2], color: 0xFF0000 },
                { position: [1.3, 3, 0], size: [0.2, 2, 0.2], color: 0xFF0000 },
                { position: [0, 3, 0], size: [2, 0.3, 0.2], color: 0xFF0000 },
                { position: [0, 1.8, 0], size: [3, 0.3, 0.2], color: 0xFF0000 },
                { position: [-0.8, 2.4, 0], size: [0.2, 1.5, 0.2], color: 0xFF0000, rotation: [0, 0, Math.PI/6] },
                { position: [0.8, 2.4, 0], size: [0.2, 1.5, 0.2], color: 0xFF0000, rotation: [0, 0, -Math.PI/6] },
                { position: [0, 2.5, 0], size: [0.2, 1, 0.2], color: 0xFF0000 },
                { position: [-0.6, 1.2, 0], size: [0.8, 0.2, 0.2], color: 0xFF0000 },
                { position: [0.6, 1.2, 0], size: [0.8, 0.2, 0.2], color: 0xFF0000 },
                { position: [-0.6, 0.6, 0], size: [0.8, 0.2, 0.2], color: 0xFF0000 },
                { position: [0.6, 0.6, 0], size: [0.8, 0.2, 0.2], color: 0xFF0000 },
                { position: [-1, 0.9, 0], size: [0.2, 0.8, 0.2], color: 0xFF0000 },
                { position: [1, 0.9, 0], size: [0.2, 0.8, 0.2], color: 0xFF0000 },
                { position: [0, 0.9, 0], size: [0.2, 0.8, 0.2], color: 0xFF0000 },
            ];
            
            strokes.forEach((stroke, index) => {
                const geometry = new THREE.BoxGeometry(...stroke.size);
                const material = new THREE.MeshPhongMaterial({ 
                    color: stroke.color,
                    emissive: stroke.color,
                    emissiveIntensity: fuCharacterBrightness,
                    shininess: 30,
                    transparent: true,
                    opacity: 0.9
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(...stroke.position);
                
                if (stroke.rotation) {
                    mesh.rotation.set(...stroke.rotation);
                }
                
                // ç¬”ç”»å…‰æ™•
                const glowGeometry = new THREE.BoxGeometry(
                    stroke.size[0] + 0.1, 
                    stroke.size[1] + 0.1, 
                    stroke.size[2] + 0.1
                );
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: stroke.color,
                    transparent: true,
                    opacity: 0.2,
                    blending: THREE.AdditiveBlending,
                    side: THREE.BackSide
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                glow.position.set(...stroke.position);
                
                if (stroke.rotation) {
                    glow.rotation.set(...stroke.rotation);
                }
                
                mesh.userData = {
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed * (0.5 + Math.random() * 0.5),
                    glow: glow
                };
                
                glow.userData = {
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed * (0.5 + Math.random() * 0.5)
                };
                
                fuCharacterGroup.add(mesh);
                fuCharacterGroup.add(glow);
            });
        }
        
        // ä¿®å¤çš„ä¸å¸¦åˆ›å»ºå‡½æ•°
        function createFixedRibbons() {
            const ribbonCount = isMobileDevice() ? 4 : 8;
            
            for (let i = 0; i < ribbonCount; i++) {
                const angle = (i / ribbonCount) * Math.PI * 2;
                const radius = isMobileDevice() ? 15 : 30;
                
                // é€‰æ‹©éœ“è™¹é¢œè‰²
                const colors = neonColors[i % neonColors.length];
                const ribbonColor = colors[0];
                const highlightColor = colors[1];
                
                // åˆ›å»ºæ›´ç®€å•çš„ä¸å¸¦å‡ ä½•ä½“
                const ribbonGeometry = new THREE.BoxGeometry(0.2, 20, 0.05);
                const ribbonMaterial = new THREE.MeshPhongMaterial({ 
                    color: ribbonColor,
                    emissive: ribbonColor,
                    emissiveIntensity: neonIntensity * 0.7,
                    shininess: 50,
                    transparent: true,
                    opacity: 0.9,
                    side: THREE.DoubleSide
                });
                
                const ribbon = new THREE.Mesh(ribbonGeometry, ribbonMaterial);
                
                // è®¾ç½®ä¸å¸¦ä½ç½®å’Œæ—‹è½¬
                const ribbonRadius = isMobileDevice() ? 12 : 20;
                ribbon.position.set(
                    Math.cos(angle) * ribbonRadius,
                    10,
                    Math.sin(angle) * ribbonRadius
                );
                ribbon.rotation.y = angle + Math.PI/2;
                
                // ä¸å¸¦å…‰æ™•
                const glowGeometry = new THREE.PlaneGeometry(0.4, 21);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: highlightColor,
                    transparent: true,
                    opacity: 0.2,
                    blending: THREE.AdditiveBlending,
                    side: THREE.DoubleSide
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                glow.position.copy(ribbon.position);
                glow.rotation.copy(ribbon.rotation);
                
                // ä¸å¸¦ç»“
                const knotGeometry = new THREE.TorusGeometry(0.4, 0.15, 16, 32);
                const knotMaterial = new THREE.MeshPhongMaterial({ 
                    color: highlightColor,
                    emissive: highlightColor,
                    emissiveIntensity: neonIntensity,
                    shininess: 30,
                    transparent: true,
                    opacity: 0.9
                });
                const knot = new THREE.Mesh(knotGeometry, knotMaterial);
                knot.position.set(0, 20, 0);
                
                // ä¸å¸¦ç»“å…‰æ™•
                const knotGlowGeometry = new THREE.SphereGeometry(0.6, 16, 16);
                const knotGlowMaterial = new THREE.MeshBasicMaterial({
                    color: ribbonColor,
                    transparent: true,
                    opacity: 0.3,
                    blending: THREE.AdditiveBlending
                });
                const knotGlow = new THREE.Mesh(knotGlowGeometry, knotGlowMaterial);
                knotGlow.position.copy(knot.position);
                
                ribbon.userData = {
                    rotateSpeed: (0.01 + Math.random() * 0.02) * ribbonSpeed,
                    waveSpeed: 0.5 + Math.random() * 0.5,
                    waveAmplitude: 0.1 + Math.random() * 0.2,
                    offset: Math.random() * Math.PI * 2,
                    originalPosition: ribbon.position.clone(),
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed * 0.8,
                    originalRotation: ribbon.rotation.clone()
                };
                
                glow.userData = {
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed * 0.7
                };
                
                knot.userData = {
                    rotateSpeed: (0.02 + Math.random() * 0.03) * ribbonSpeed,
                    floatSpeed: 0.3 + Math.random() * 0.3,
                    floatAmplitude: 0.1,
                    offset: Math.random() * Math.PI * 2,
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed
                };
                
                knotGlow.userData = {
                    pulseOffset: Math.random() * Math.PI * 2,
                    pulseSpeed: blinkSpeed * 0.6
                };
                
                scene.add(ribbon);
                scene.add(glow);
                scene.add(knot);
                scene.add(knotGlow);
                
                neonRibbons.push({
                    ribbon: ribbon,
                    glow: glow,
                    knot: knot,
                    knotGlow: knotGlow,
                    color: ribbonColor,
                    highlightColor: highlightColor
                });
            }
        }
        
        // åˆ›å»ºéœ“è™¹ç²’å­
        function createNeonParticles() {
            const particleCount = isMobileDevice() ? 50 : 200;
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];
            const sizes = [];
            
            for (let i = 0; i < particleCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = 35 + Math.random() * 15;
                const height = Math.random() * 20;
                
                positions.push(
                    Math.cos(angle) * radius,
                    height,
                    Math.sin(angle) * radius
                );
                
                const colorSet = neonColors[Math.floor(Math.random() * neonColors.length)];
                const color = colorSet[Math.floor(Math.random() * 2)];
                const threeColor = new THREE.Color(color);
                
                colors.push(threeColor.r, threeColor.g, threeColor.b);
                sizes.push(0.1 + Math.random() * 0.3);
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));
            
            const material = new THREE.PointsMaterial({
                size: 0.3,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending,
                sizeAttenuation: true
            });
            
            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            
            particles.userData = {
                positions: positions,
                originalSizes: sizes.slice(),
                pulseSpeeds: new Array(particleCount).fill(0).map(() => 0.5 + Math.random() * 1.5),
                pulseOffsets: new Array(particleCount).fill(0).map(() => Math.random() * Math.PI * 2),
                orbitSpeeds: new Array(particleCount).fill(0).map(() => 0.01 + Math.random() * 0.05),
                orbitAngles: new Array(particleCount).fill(0).map(() => Math.random() * Math.PI * 2),
                floatSpeeds: new Array(particleCount).fill(0).map(() => 0.1 + Math.random() * 0.3)
            };
            
            neonParticles.push(particles);
        }
        
        // åˆ›å»ºéœ“ç¯å…‰æŸ
        function createNeonLightStreaks() {
            const streakCount = isMobileDevice() ? 4 : 8;
            
            for (let i = 0; i < streakCount; i++) {
                const colorSet = neonColors[i % neonColors.length];
                const color = colorSet[0];
                
                const geometry = new THREE.CylinderGeometry(0.05, 0.05, 40, 8);
                const material = new THREE.MeshBasicMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.2,
                    blending: THREE.AdditiveBlending,
                    side: THREE.DoubleSide
                });
                
                const streak = new THREE.Mesh(geometry, material);
                const angle = (i / streakCount) * Math.PI * 2;
                
                streak.position.set(
                    Math.cos(angle) * 10,
                    20,
                    Math.sin(angle) * 10
                );
                streak.rotation.x = Math.PI / 2;
                streak.rotation.z = angle;
                
                streak.userData = {
                    angle: angle,
                    pulseSpeed: 0.2 + Math.random() * 0.3,
                    pulseOffset: Math.random() * Math.PI * 2,
                    rotateSpeed: 0.01 + Math.random() * 0.02
                };
                
                scene.add(streak);
                neonParticles.push(streak);
            }
        }
        
        // ====== éœ“è™¹çƒŸèŠ±ç³»ç»Ÿ ======
        function launchNeonFireworks(count = 1) {
            const fireworkPower = isMobileDevice() ? 2 : 3;
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const x = (Math.random() - 0.5) * 35;
                    const z = (Math.random() - 0.5) * 35;
                    createNeonFirework(x, 10, z, fireworkPower);
                    
                    fireworkCount++;
                    updateFireworkCount();
                    
                }, i * 150);
            }
        }
        
        function createNeonFirework(x, y, z, power) {
            const particleCount = isMobileDevice() ? 100 : 200 + power * 100;
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];
            
            let colorScheme;
            switch(colorMode) {
                case 1:
                    colorScheme = [0xFF00FF, 0xFF00FF];
                    break;
                case 2:
                    colorScheme = neonColors[Math.floor(Math.random() * neonColors.length)];
                    break;
                case 3:
                    const color1 = rainbowColors[Math.floor(Math.random() * rainbowColors.length)];
                    const color2 = rainbowColors[(Math.floor(Math.random() * rainbowColors.length) + 1) % rainbowColors.length];
                    colorScheme = [color1, color2];
                    break;
            }
            
            const velocities = [];
            
            for (let i = 0; i < particleCount; i++) {
                positions.push(x, y, z);
                
                const useMain = Math.random() > 0.5;
                const color = useMain ? colorScheme[0] : colorScheme[1];
                
                colors.push(
                    (color >> 16 & 255) / 255,
                    (color >> 8 & 255) / 255,
                    (color & 255) / 255
                );
                
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                const speed = 0.4 + Math.random() * 0.6;
                
                velocities.push({
                    x: Math.sin(phi) * Math.cos(theta) * speed,
                    y: Math.cos(phi) * speed,
                    z: Math.sin(phi) * Math.sin(theta) * speed,
                    life: 1.2 + Math.random() * 0.8
                });
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.2,
                vertexColors: true,
                transparent: true,
                opacity: 1.0,
                blending: THREE.AdditiveBlending,
                depthWrite: false,
                sizeAttenuation: true
            });
            
            const firework = new THREE.Points(geometry, material);
            scene.add(firework);
            
            createNeonExplosion(x, y, z, colorScheme[0]);
            
            let age = 0;
            const maxAge = 2.5;
            
            function animateFirework() {
                age += 0.016;
                
                if (age < maxAge) {
                    const positions = firework.geometry.attributes.position.array;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        const lifeProgress = age / velocities[i].life;
                        
                        if (lifeProgress < 1) {
                            positions[i3] += velocities[i].x;
                            positions[i3 + 1] += velocities[i].y;
                            positions[i3 + 2] += velocities[i].z;
                            
                            velocities[i].y -= 0.015;
                            velocities[i].x *= 0.985;
                            velocities[i].y *= 0.985;
                            velocities[i].z *= 0.985;
                        }
                    }
                    
                    firework.geometry.attributes.position.needsUpdate = true;
                    firework.material.opacity = 1 - Math.pow(age / maxAge, 2);
                    requestAnimationFrame(animateFirework);
                } else {
                    scene.remove(firework);
                    firework.geometry.dispose();
                    firework.material.dispose();
                }
            }
            
            animateFirework();
        }
        
        function createNeonExplosion(x, y, z, color) {
            const geometry = new THREE.SphereGeometry(1, 32, 32);
            const material = new THREE.MeshBasicMaterial({
                color: color,
                transparent: true,
                opacity: 1.0,
                blending: THREE.AdditiveBlending,
                side: THREE.BackSide
            });
            
            const explosion = new THREE.Mesh(geometry, material);
            explosion.position.set(x, y, z);
            scene.add(explosion);
            
            const waveGeometry = new THREE.RingGeometry(0.1, 1, 32);
            const waveMaterial = new THREE.MeshBasicMaterial({
                color: color,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending,
                side: THREE.DoubleSide
            });
            
            const wave = new THREE.Mesh(waveGeometry, waveMaterial);
            wave.position.set(x, y, z);
            wave.rotation.x = Math.PI / 2;
            scene.add(wave);
            
            let scale = 1;
            let opacity = 1;
            let waveScale = 1;
            let waveOpacity = 0.8;
            
            function animateExplosion() {
                scale += 0.25;
                opacity -= 0.12;
                waveScale += 0.5;
                waveOpacity -= 0.08;
                
                explosion.scale.set(scale, scale, scale);
                explosion.material.opacity = opacity;
                
                wave.scale.set(waveScale, waveScale, 1);
                wave.material.opacity = waveOpacity;
                
                if (opacity > 0) {
                    requestAnimationFrame(animateExplosion);
                } else {
                    scene.remove(explosion);
                    scene.remove(wave);
                    explosion.geometry.dispose();
                    explosion.material.dispose();
                    wave.geometry.dispose();
                    wave.material.dispose();
                }
            }
            
            animateExplosion();
        }
        
        // ====== UIæ§åˆ¶ ======
        function updateFireworkCount() {
            document.getElementById('fireworkCount').textContent = fireworkCount;
        }
        
        function updateWish() {
            const wish = wishes[wishIndex];
            document.getElementById('wishTitle').textContent = wish.title;
            document.getElementById('wishContent').textContent = wish.content;
            document.getElementById('wishAuthor').textContent = '- ' + wish.author + ' -';
        }
        
        function nextWish() {
            wishIndex = (wishIndex + 1) % wishes.length;
            updateWish();
            launchNeonFireworks(1);
        }
        
        function applySettings() {
            neonIntensity = parseFloat(document.getElementById('neonIntensitySlider').value);
            ribbonSpeed = parseFloat(document.getElementById('ribbonSpeedSlider').value);
            fuCharacterBrightness = parseFloat(document.getElementById('fuCharacterBrightnessSlider').value);
            glowRadius = parseInt(document.getElementById('glowRadiusSlider').value);
            blinkSpeed = parseFloat(document.getElementById('blinkSpeedSlider').value);
            colorMode = parseInt(document.getElementById('colorModeSlider').value);
            isNeonGlow = document.getElementById('neonGlowToggle').checked;
            isRibbonAnimating = document.getElementById('ribbonAnimationToggle').checked;
            isFuRotating = document.getElementById('fuRotationToggle').checked;
            isBlinking = document.getElementById('blinkToggle').checked;
            isAutoRotating = document.getElementById('autoRotateToggle').checked;
            
            const colorModeText = ['å•è‰²', 'å¤šå½©', 'å½©è™¹'][colorMode - 1];
            document.getElementById('colorModeValue').textContent = colorModeText;
            
            neonRibbons.forEach(ribbonData => {
                if (ribbonData.ribbon.userData) {
                    ribbonData.ribbon.userData.rotateSpeed = (0.01 + Math.random() * 0.02) * ribbonSpeed;
                }
                if (ribbonData.knot.userData) {
                    ribbonData.knot.userData.rotateSpeed = (0.02 + Math.random() * 0.03) * ribbonSpeed;
                }
            });
            
            document.getElementById('neonIntensityValue').textContent = neonIntensity.toFixed(1);
            document.getElementById('ribbonSpeedValue').textContent = ribbonSpeed.toFixed(1);
            document.getElementById('fuCharacterBrightnessValue').textContent = fuCharacterBrightness.toFixed(1);
            document.getElementById('glowRadiusValue').textContent = glowRadius;
            document.getElementById('blinkSpeedValue').textContent = blinkSpeed.toFixed(1);
            
            console.log("éœ“è™¹è®¾ç½®å·²åº”ç”¨");
        }
        
        function toggleAutoRotate() {
            isAutoRotating = !isAutoRotating;
            const btn = document.getElementById('rotateBtn');
            const icon = btn.querySelector('i');
            icon.className = isAutoRotating ? 'fas fa-pause' : 'fas fa-play';
            
            // å¦‚æœä½¿ç”¨OrbitControlsï¼Œæ›´æ–°è‡ªåŠ¨æ—‹è½¬
            if (controls && controls.autoRotate !== undefined) {
                controls.autoRotate = isAutoRotating;
                controls.autoRotateSpeed = 0.5;
            }
        }
        
        function resetView() {
            camera.position.set(0, 20, 45);
            camera.lookAt(0, 0, 0);
            if (controls && controls.reset) {
                controls.reset();
            }
        }
        
        function toggleMusic() {
            if (!audio) {
                audio = new Audio();
                audio.src = 'https://assets.mixkit.co/music/preview/mixkit-happy-new-year-480.mp3';
                audio.loop = true;
                audio.volume = 0.5;
                audio.play().then(() => {
                    isMusicPlaying = true;
                    updateMusicButton();
                }).catch(e => {
                    console.log("éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢:", e);
                    showMobileTip("ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®åï¼Œå†ç‚¹å‡»éŸ³ä¹æŒ‰é’®");
                });
            } else {
                if (isMusicPlaying) {
                    audio.pause();
                } else {
                    audio.play();
                }
                isMusicPlaying = !isMusicPlaying;
                updateMusicButton();
            }
        }
        
        function toggleNeonMode() {
            isNeonMode = !isNeonMode;
            const btn = document.getElementById('neonBtn');
            const icon = btn.querySelector('i');
            
            if (isNeonMode) {
                icon.className = 'fas fa-lightbulb';
                btn.style.boxShadow = '0 0 30px rgba(255, 0, 255, 0.5)';
            } else {
                icon.className = 'fas fa-lightbulb';
                btn.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.3)';
            }
        }
        
        function updateMusicButton() {
            const btn = document.getElementById('musicBtn');
            if (btn) {
                const icon = btn.querySelector('i');
                if (icon) {
                    icon.className = isMusicPlaying ? 'fas fa-pause' : 'fas fa-play';
                }
            }
        }
        
        // ====== äº‹ä»¶ç›‘å¬ ======
        function setupEventListeners() {
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            document.getElementById('neonIntensitySlider').addEventListener('input', (e) => {
                document.getElementById('neonIntensityValue').textContent = e.target.value;
            });
            
            document.getElementById('ribbonSpeedSlider').addEventListener('input', (e) => {
                document.getElementById('ribbonSpeedValue').textContent = e.target.value;
            });
            
            document.getElementById('fuCharacterBrightnessSlider').addEventListener('input', (e) => {
                document.getElementById('fuCharacterBrightnessValue').textContent = e.target.value;
            });
            
            document.getElementById('glowRadiusSlider').addEventListener('input', (e) => {
                document.getElementById('glowRadiusValue').textContent = e.target.value;
            });
            
            document.getElementById('blinkSpeedSlider').addEventListener('input', (e) => {
                document.getElementById('blinkSpeedValue').textContent = e.target.value;
            });
            
            document.getElementById('colorModeSlider').addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                const text = ['å•è‰²', 'å¤šå½©', 'å½©è™¹'][value - 1];
                document.getElementById('colorModeValue').textContent = text;
            });
            
            // ç‚¹å‡»åœºæ™¯æ”¾çƒŸèŠ±
            renderer.domElement.addEventListener('click', (e) => {
                if (e.target === renderer.domElement) {
                    launchNeonFireworks(1);
                }
            });
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        launchNeonFireworks(3);
                        break;
                    case 'r':
                        resetView();
                        break;
                    case 'm':
                        toggleMusic();
                        break;
                    case 'a':
                        toggleAutoRotate();
                        break;
                    case 'ArrowRight':
                        nextWish();
                        break;
                    case 'n':
                        toggleNeonMode();
                        break;
                    case 'f':
                        launchFireworksAroundFu();
                        break;
                }
            });
            
            // é”™è¯¯å¤„ç†
            window.addEventListener('error', (e) => {
                console.error('å…¨å±€é”™è¯¯:', e.message, e.filename, e.lineno);
                const errorDiv = document.getElementById('errorMessage');
                if (errorDiv) {
                    errorDiv.style.display = 'block';
                    setTimeout(() => {
                        errorDiv.style.display = 'none';
                    }, 5000);
                }
            });
            
            // ç½‘ç»œçŠ¶æ€
            window.addEventListener('online', () => {
                console.log('ç½‘ç»œå·²è¿æ¥');
            });
            
            window.addEventListener('offline', () => {
                console.error('ç½‘ç»œå·²æ–­å¼€');
                showMobileTip('âš ï¸ ç½‘ç»œè¿æ¥å·²æ–­å¼€');
            });
        }
        
        function launchFireworksAroundFu() {
            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const angle = (i / 6) * Math.PI * 2;
                    const radius = 5;
                    const x = Math.cos(angle) * radius;
                    const z = Math.sin(angle) * radius;
                    createNeonFirework(x, 15, z, 2);
                    fireworkCount++;
                    updateFireworkCount();
                }, i * 200);
            }
        }
        
        // ====== åŠ¨ç”»å¾ªç¯ ======
        function animate() {
            requestAnimationFrame(animate);
            
            const time = Date.now() * 0.001;
            
            // æ›´æ–°è‡ªåŠ¨æ—‹è½¬
            if (isAutoRotating && controls) {
                if (controls.autoRotate !== undefined) {
                    controls.autoRotate = true;
                    controls.autoRotateSpeed = 0.5;
                }
            } else if (controls && controls.autoRotate !== undefined) {
                controls.autoRotate = false;
            }
            
            // æ›´æ–°æ§ä»¶
            if (controls && controls.update) {
                controls.update();
            }
            
            // å¦‚æœæ˜¯ç®€åŒ–æ§åˆ¶ï¼Œè°ƒç”¨æ›´æ–°å‡½æ•°
            if (window.simpleControlsUpdate && (!controls || window.useSimpleControls)) {
                window.simpleControlsUpdate();
            }
            
            // æ›´æ–°ç¯ç¬¼åŠ¨ç”»
            lanterns.forEach((lantern) => {
                if (lantern.userData) {
                    lantern.rotation.z = Math.sin(time * lantern.userData.swingSpeed + lantern.userData.swingOffset) * 0.3;
                    
                    lantern.position.y = lantern.userData.originalY + 
                        Math.sin(time * lantern.userData.swingSpeed * 0.7 + lantern.userData.floatOffset) * 1.2;
                    
                    lantern.rotation.y += 0.005 * lantern.userData.rotateSpeed;
                    
                    if (isBlinking) {
                        const pulse = 0.5 + 0.5 * Math.sin(time * lantern.userData.pulseSpeed + lantern.userData.pulseOffset);
                        
                        lantern.traverse(child => {
                            if (child.material && child.material.emissive) {
                                child.material.emissiveIntensity = neonIntensity * pulse;
                            }
                        });
                        
                        if (lantern.userData.light) {
                            lantern.userData.light.intensity = neonIntensity * 1.5 * pulse;
                        }
                        
                        if (lantern.userData.glow) {
                            lantern.userData.glow.material.opacity = 0.2 * pulse;
                        }
                    }
                }
            });
            
            // æ›´æ–°ç¦å­—
            if (fuCharacterGroup) {
                if (isFuRotating) {
                    fuCharacterGroup.rotation.y += fuCharacterGroup.userData.rotateSpeed;
                }
                
                const float = Math.sin(time * fuCharacterGroup.userData.floatSpeed + fuCharacterGroup.userData.floatOffset) * 0.3;
                fuCharacterGroup.position.y = 10 + float;
                
                if (isBlinking) {
                    const pulse = 0.5 + 0.5 * Math.sin(time * fuCharacterGroup.userData.pulseSpeed + fuCharacterGroup.userData.pulseOffset);
                    
                    fuCharacterGroup.traverse(child => {
                        if (child.material && child.material.emissive) {
                            if (child.material.emissive.getHex() === 0xFF0000) {
                                child.material.emissiveIntensity = fuCharacterBrightness * pulse;
                            } else if (child.material.emissive.getHex() === 0xFFFF00) {
                                child.material.emissiveIntensity = fuCharacterBrightness * 1.5 * pulse;
                            } else if (child.material.emissive.getHex() === 0xFF00FF) {
                                child.material.emissiveIntensity = fuCharacterBrightness * pulse;
                            }
                        }
                        
                        if (child.userData && child.userData.glow) {
                            const glowPulse = 0.2 + 0.1 * Math.sin(time * child.userData.pulseSpeed + child.userData.pulseOffset);
                            child.userData.glow.material.opacity = glowPulse;
                        }
                    });
                }
            }
            
            // æ›´æ–°éœ“è™¹ä¸å¸¦
            if (isRibbonAnimating) {
                neonRibbons.forEach(ribbonData => {
                    const ribbon = ribbonData.ribbon;
                    const glow = ribbonData.glow;
                    const knot = ribbonData.knot;
                    const knotGlow = ribbonData.knotGlow;
                    
                    if (ribbon.userData) {
                        const orbitAngle = time * ribbon.userData.rotateSpeed + ribbon.userData.offset;
                        const orbitRadius = isMobileDevice() ? 12 : 20;
                        ribbon.position.x = Math.cos(orbitAngle) * orbitRadius;
                        ribbon.position.z = Math.sin(orbitAngle) * orbitRadius;
                        
                        ribbon.lookAt(0, ribbon.position.y, 0);
                        ribbon.rotateY(Math.PI/2);
                        
                        const wave = Math.sin(time * ribbon.userData.waveSpeed + ribbon.userData.offset) * ribbon.userData.waveAmplitude;
                        ribbon.rotation.z = wave;
                        
                        if (isBlinking) {
                            const pulse = 0.7 + 0.3 * Math.sin(time * ribbon.userData.pulseSpeed + ribbon.userData.pulseOffset);
                            ribbon.material.emissiveIntensity = neonIntensity * 0.7 * pulse;
                        }
                    }
                    
                    glow.position.copy(ribbon.position);
                    glow.rotation.copy(ribbon.rotation);
                    
                    if (glow.userData && isNeonGlow) {
                        const pulse = Math.sin(time * glow.userData.pulseSpeed + glow.userData.pulseOffset) * 0.2 + 0.8;
                        glow.material.opacity = 0.2 * pulse;
                    }
                    
                    if (knot.userData) {
                        knot.rotation.y += knot.userData.rotateSpeed;
                        knot.rotation.x = Math.sin(time * knot.userData.floatSpeed + knot.userData.offset) * 0.1;
                        
                        if (isBlinking) {
                            const pulse = 0.5 + 0.5 * Math.sin(time * knot.userData.pulseSpeed + knot.userData.pulseOffset);
                            knot.material.emissiveIntensity = neonIntensity * pulse;
                        }
                    }
                    
                    if (knotGlow.userData && isNeonGlow) {
                        const pulse = Math.sin(time * knotGlow.userData.pulseSpeed + knotGlow.userData.pulseOffset) * 0.2 + 0.8;
                        knotGlow.material.opacity = 0.3 * pulse;
                        
                        knotGlow.rotation.y = knot.rotation.y;
                        knotGlow.position.y = knot.position.y;
                    }
                });
            }
            
            // æ›´æ–°éœ“è™¹ç²’å­
            neonParticles.forEach(particles => {
                if (particles.isPoints) {
                    const sizes = particles.geometry.attributes.size.array;
                    const userData = particles.userData;
                    
                    for (let i = 0; i < sizes.length; i++) {
                        const pulse = Math.sin(time * userData.pulseSpeeds[i] + userData.pulseOffsets[i]) * 0.3 + 0.7;
                        sizes[i] = userData.originalSizes[i] * pulse;
                        
                        const positions = particles.geometry.attributes.position.array;
                        const i3 = i * 3;
                        
                        const angle = userData.orbitAngles[i] + time * userData.orbitSpeeds[i];
                        const radius = Math.sqrt(positions[i3] * positions[i3] + positions[i3 + 2] * positions[i3 + 2]);
                        
                        positions[i3] = Math.cos(angle) * radius;
                        positions[i3 + 2] = Math.sin(angle) * radius;
                        
                        positions[i3 + 1] += Math.sin(time * userData.floatSpeeds[i]) * 0.01;
                    }
                    
                    particles.geometry.attributes.size.needsUpdate = true;
                    particles.geometry.attributes.position.needsUpdate = true;
                }
                
                if (particles.userData && particles.userData.pulseSpeed) {
                    const pulse = Math.sin(time * particles.userData.pulseSpeed + particles.userData.pulseOffset) * 0.3 + 0.7;
                    particles.material.opacity = 0.2 * pulse;
                    
                    if (particles.userData.rotateSpeed) {
                        particles.rotation.y += 0.01 * particles.userData.rotateSpeed;
                    }
                }
            });
            
            // æ›´æ–°éœ“è™¹ç¯å…‰
            neonLights.forEach(light => {
                if (light.userData) {
                    const pulse = Math.sin(time * light.userData.pulseSpeed + light.userData.pulseOffset) * 0.3 + 0.7;
                    light.intensity = 0.8 * pulse;
                    
                    light.position.y = light.userData.originalY + Math.sin(time * 0.3) * 2;
                }
            });
            
            renderer.render(scene, camera);
        }
        
        // ====== æ¨ªå±æ£€æµ‹ ======
        function checkOrientation() {
            const warning = document.getElementById('landscapeWarning');
            if (window.innerHeight > window.innerWidth && window.innerHeight < 600) {
                warning.style.display = 'flex';
            } else {
                warning.style.display = 'none';
            }
        }
        
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', function() {
            setTimeout(checkOrientation, 500);
            setTimeout(function() {
                location.reload();
            }, 1000);
        });
        
        // åˆå§‹æ£€æŸ¥
        checkOrientation();
        
        // å¼ºåˆ¶HTTPSï¼ˆåœ¨æœ¬åœ°å¼€å‘æ—¶ä¸éœ€è¦ï¼‰
        if (window.location.protocol === 'http:' && window.location.hostname !== 'localhost') {
            window.location.href = window.location.href.replace('http:', 'https:');
        }
        
        // é¡µé¢å¯è§æ€§API - èŠ‚çœèµ„æº
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶æš‚åœéŸ³ä¹
                if (audio && isMusicPlaying) {
                    audio.pause();
                }
            } else {
                // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤éŸ³ä¹
                if (audio && isMusicPlaying) {
                    audio.play().catch(e => console.log("éŸ³ä¹æ¢å¤å¤±è´¥:", e));
                }
            }
        });
        
        console.log("2026æ–°å¹´è´ºå¡ - ä¿®å¤ç‰ˆå·²åŠ è½½");
    </script>
</body>
</html>
